<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scheme Information - Tribal Land System</title>
    
    <!-- Prevent caching to ensure fresh loads -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .breadcrumb {
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 25px;
            color: white;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .breadcrumb a {
            color: white;
            text-decoration: none;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        .breadcrumb a:hover {
            opacity: 1;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .api-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .api-status.connected {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
        }

        .api-status.disconnected {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
        }

        .api-status.loading {
            background: linear-gradient(45deg, #ffc107, #fd7e14);
            color: white;
        }

        .loading-spinner {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .overview-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            margin-bottom: 40px;
            text-align: center;
        }

        .overview-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .stat-item {
            padding: 20px;
            background: #f8f9ff;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-weight: 600;
        }

        .schemes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .scheme-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            transition: all 0.4s ease;
            position: relative;
        }

        .scheme-card:hover {
            transform: translateY(-15px);
            box-shadow: 0 25px 60px rgba(0,0,0,0.25);
        }

        .scheme-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .scheme-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            position: relative;
            z-index: 2;
        }

        .scheme-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
            position: relative;
            z-index: 2;
        }

        .scheme-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }

        .scheme-content {
            padding: 30px;
        }

        .scheme-description {
            color: #666;
            line-height: 1.8;
            margin-bottom: 25px;
            font-size: 1.1rem;
        }

        .eligibility-section {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .eligibility-title {
            color: #333;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .eligibility-list {
            list-style: none;
            padding: 0;
        }

        .eligibility-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .eligibility-list li:last-child {
            border-bottom: none;
        }

        .eligibility-list li::before {
            content: "‚úì";
            background: #28a745;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .benefits-section {
            background: #fff8e1;
            padding: 20px;
            border-radius: 12px;
            border-left: 5px solid #ffc107;
            margin-bottom: 20px;
        }

        .benefits-title {
            color: #333;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .application-process {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 12px;
            border-left: 5px solid #28a745;
        }

        .process-steps {
            list-style: none;
            padding: 0;
            counter-reset: step-counter;
        }

        .process-steps li {
            counter-increment: step-counter;
            padding: 10px 0;
            position: relative;
            padding-left: 40px;
        }

        .process-steps li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 10px;
            background: #28a745;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .quick-eligibility {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            margin-bottom: 40px;
        }

        .eligibility-checker {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .input-group input,
        .input-group select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-refresh {
            background: linear-gradient(45deg, #28a745, #20c997);
        }

        .results-display {
            margin-top: 20px;
            padding: 20px;
            border-radius: 12px;
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .results-display.eligible {
            background: #d4edda;
            border-left: 5px solid #28a745;
        }

        .results-display.not-eligible {
            background: #f8d7da;
            border-left: 5px solid #dc3545;
        }

        .scheme-list {
            list-style: none;
            padding: 0;
            margin-top: 15px;
        }

        .scheme-list li {
            background: rgba(255,255,255,0.8);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #dc3545;
            margin: 20px 0;
        }

        .loading-placeholder {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
        }

        .contact-info {
            background: #667eea;
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: center;
        }

        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .contact-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .schemes-grid {
                grid-template-columns: 1fr;
            }
            
            .eligibility-checker {
                grid-template-columns: 1fr;
            }
            
            .overview-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .header h1 {
                font-size: 2rem;
            }
        }

        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            z-index: 999;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }
    </style>
</head>
<body>
    <!-- API Status indicator -->
    <div id="apiStatus" class="api-status loading">
        <span class="loading-spinner"></span>
        Connecting to API...
    </div>

    <div class="container fade-in">
        <div class="breadcrumb">
            <a href="javascript:void(0)" onclick="goToDashboard()">üè† Dashboard</a> / üéØ Scheme Information
        </div>

        <div class="header">
            <h1>üéØ Government Scheme Information</h1>
            <p>Live data from Government APIs - Updated in real-time</p>
            <button class="btn btn-refresh" onclick="refreshSchemeData()" id="refreshBtn">
                üîÑ Refresh Data
            </button>
        </div>

        <!-- Overview -->
        <div class="overview-card" id="overviewCard">
            <h2 style="color: #333; margin-bottom: 20px;">üìä Schemes Overview</h2>
            <div id="overviewContent">
                <div class="loading-placeholder">
                    <div class="loading-spinner" style="margin-right: 10px;"></div>
                    Loading scheme data from Government API...
                </div>
            </div>
        </div>

        <!-- Quick Eligibility Checker -->
        <div class="quick-eligibility" id="eligibilityChecker">
            <h2 style="color: #333; margin-bottom: 20px;">‚ö° Quick Eligibility Checker</h2>
            <p style="color: #666; margin-bottom: 20px;">Enter your details to check eligibility for live schemes</p>
            
            <div class="eligibility-checker">
                <div class="input-group">
                    <label>Land Area (acres)</label>
                    <input type="number" id="checkLandArea" step="0.01" min="0" placeholder="e.g., 2.5">
                </div>
                <div class="input-group">
                    <label>Land Type</label>
                    <select id="checkLandType">
                        <option value="">Select land type</option>
                        <option value="Agricultural">Agricultural</option>
                        <option value="Residential">Residential</option>
                        <option value="Forest">Forest</option>
                        <option value="Barren">Barren</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Annual Income (‚Çπ)</label>
                    <input type="number" id="checkIncome" min="0" placeholder="e.g., 25000">
                </div>
                <div class="input-group">
                    <label style="opacity: 0;">Action</label>
                    <button class="btn" onclick="checkEligibility()" id="checkBtn">Check Eligibility</button>
                </div>
            </div>
            
            <div id="eligibilityResults" class="results-display"></div>
        </div>

        <!-- Scheme Cards Container -->
        <div id="schemesContainer">
            <div class="loading-placeholder">
                <div class="loading-spinner" style="margin-right: 10px;"></div>
                Fetching latest schemes from Government database...
            </div>
        </div>

        <!-- Contact Information -->
        <!-- <div class="contact-info">
            <h2 style="margin-bottom: 20px;">üìû Contact Information</h2>
            <p style="margin-bottom: 20px;">For more information or assistance with scheme applications</p>
            
            <div class="contact-grid">
                <div class="contact-item">
                    <h4>üìû Helpline</h4>
                    <p>1800-180-1551</p>
                    <p>Available 24/7</p>
                </div>
                <div class="contact-item">
                    <h4>üåê Website</h4>
                    <p>pmkisan.gov.in</p>
                    <p>jaljeevanmission.gov.in</p>
                </div>
                <div class="contact-item">
                    <h4>üìß Email</h4>
                    <p>support@tribalwelfare.gov.in</p>
                    <p>Response within 48 hours</p>
                </div>
                <div class="contact-item">
                    <h4>üè¢ Local Office</h4>
                    <p>District Collector Office</p>
                    <p>Block Development Office</p>
                </div>
            </div>
        </div> -->

        <!-- Floating Action Button -->
        <div class="fab" onclick="scrollToChecker()" title="Quick Eligibility Check">
            ‚ö°
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            API_KEY: '579b464db66ec23bdd000001cdd3946e44ce4aad7209ff7b23ac571b',
            API_BASE_URL: 'https://api.data.gov.in/resource/', // Example endpoint
            REFRESH_INTERVAL: 300000, // 5 minutes
            CACHE_DURATION: 600000 // 10 minutes
        };

        let schemesData = [];
        let lastFetchTime = 0;
        let autoRefreshInterval;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            fetchSchemeData();
            setupEventListeners();
            startAutoRefresh();
        });

        // Initialize page components
        function initializePage() {
            updateApiStatus('loading', 'Connecting to API...');
            setupFormValidation();
            initializeAnimations();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Handle network status
            window.addEventListener('online', () => {
                showAlert('Connection restored', 'success');
                fetchSchemeData();
            });

            window.addEventListener('offline', () => {
                updateApiStatus('disconnected', 'Offline - Using cached data');
            });

            // Handle visibility change
            document.addEventListener('visibilitychange', () => {
                if (!document.hidden) {
                    checkDataFreshness();
                }
            });
        }

        // Fetch scheme data from API
        async function fetchSchemeData() {
            try {
                updateApiStatus('loading', 'Fetching scheme data...');
                
                // Simulate API call (replace with actual government API endpoint)
                const response = await simulateApiCall();
                
                if (response.success) {
                    schemesData = response.data;
                    lastFetchTime = Date.now();
                    updateApiStatus('connected', `Connected - ${schemesData.length} schemes loaded`);
                    renderSchemeData();
                    updateOverview();
                } else {
                    throw new Error(response.message || 'API request failed');
                }
                
            } catch (error) {
                console.error('API Error:', error);
                updateApiStatus('disconnected', 'API Error - Using fallback data');
                loadFallbackData();
                showAlert('Using cached scheme data due to API issue', 'warning');
            }
        }

        // Simulate API call (replace with real API integration)
        async function simulateApiCall() {
            return new Promise((resolve) => {
                setTimeout(() => {
                    // Simulate API response with realistic government scheme data
                    resolve({
                        success: true,
                        data: [
                            {
                                id: 'pmkisan',
                                name: 'PM-KISAN',
                                fullName: 'Pradhan Mantri Kisan Samman Nidhi',
                                icon: 'üåæ',
                                description: 'Direct income support scheme providing ‚Çπ6,000 annually to small and marginal farmers to help them meet their agricultural needs and enhance productivity.',
                                benefits: [
                                    '‚Çπ6,000 per year (‚Çπ2,000 per installment)',
                                    'Direct bank transfer (DBT)',
                                    '3 installments per year',
                                    'No middleman involvement'
                                ],
                                eligibility: [
                                    'Must own agricultural land',
                                    'Land area should be ‚â§ 5 acres',
                                    'Must be a small/marginal farmer',
                                    'Land records should be updated'
                                ],
                                applicationProcess: [
                                    'Visit nearest CSC or agriculture office',
                                    'Submit required documents',
                                    'Complete biometric verification',
                                    'Receive acknowledgment receipt'
                                ],
                                maxBenefit: 6000,
                                landTypeRequired: ['Agricultural'],
                                maxLandArea: 5,
                                maxIncome: null
                            },
                            {
                                id: 'jaljeevan',
                                name: 'Jal Jeevan Mission',
                                fullName: 'Har Ghar Jal - Safe Water for All',
                                icon: 'üíß',
                                description: 'Flagship program to provide safe and adequate drinking water through individual piped water connections to all rural households by 2024.',
                                benefits: [
                                    'Piped water connection to household',
                                    '55 liters per person per day',
                                    'Quality monitoring and testing',
                                    'Maintenance support provided'
                                ],
                                eligibility: [
                                    'Rural household with residential property',
                                    'Agricultural land owners also eligible',
                                    'Must not have existing piped connection',
                                    'Community participation required'
                                ],
                                applicationProcess: [
                                    'Contact Gram Panchayat',
                                    'Submit household survey form',
                                    'Community meeting participation',
                                    'Technical survey and connection'
                                ],
                                maxBenefit: 'Piped Connection',
                                landTypeRequired: ['Residential', 'Agricultural'],
                                maxLandArea: null,
                                maxIncome: null
                            },
                            {
                                id: 'mgnrega',
                                name: 'MGNREGA',
                                fullName: 'Mahatma Gandhi National Rural Employment Guarantee Act',
                                icon: 'üî®',
                                description: 'Provides guaranteed 100 days of wage employment in a financial year to every rural household whose adult members volunteer to do unskilled manual work.',
                                benefits: [
                                    '100 days guaranteed employment',
                                    '‚Çπ200-300 per day wage',
                                    'Work within 5km of residence',
                                    'Skill development opportunities'
                                ],
                                eligibility: [
                                    'Adult member of rural household',
                                    'Annual income < ‚Çπ50,000',
                                    'Willing to do unskilled manual work',
                                    'Must register for job card'
                                ],
                                applicationProcess: [
                                    'Apply for job card at Gram Panchayat',
                                    'Submit required documents',
                                    'Request work when needed',
                                    'Participate in allocated work'
                                ],
                                maxBenefit: 30000,
                                landTypeRequired: ['Agricultural', 'Residential', 'Barren'],
                                maxLandArea: null,
                                maxIncome: 50000
                            },
                            {
                                id: 'dajgua',
                                name: 'DAJGUA',
                                fullName: 'District Administration Job Guarantee for Unemployed Adults',
                                icon: 'üèóÔ∏è',
                                description: 'Special employment guarantee program focused on tribal areas, providing extended employment opportunities and skill development for tribal communities.',
                                benefits: [
                                    'Extended employment days',
                                    'Higher wage rates for tribal areas',
                                    'Skill development training',
                                    'Healthcare benefits'
                                ],
                                eligibility: [
                                    'Annual income < ‚Çπ40,000',
                                    'Own agricultural or barren land',
                                    'Must be from tribal community',
                                    'Age between 18-60 years'
                                ],
                                applicationProcess: [
                                    'Visit District Collector office',
                                    'Submit tribal community certificate',
                                    'Income and land verification',
                                    'Training and work allocation'
                                ],
                                maxBenefit: 35000,
                                landTypeRequired: ['Agricultural', 'Barren'],
                                maxLandArea: null,
                                maxIncome: 40000
                            }
                        ],
                        timestamp: new Date().toISOString()
                    });
                }, 1500); // Simulate network delay
            });
        }

        // Load fallback data when API fails
        function loadFallbackData() {
            // Use the same data structure as API but mark as fallback
            simulateApiCall().then(response => {
                schemesData = response.data;
                renderSchemeData(true);
                updateOverview(true);
            });
        }

        // Render scheme data
        function renderSchemeData(isFallback = false) {
            const container = document.getElementById('schemesContainer');
            
            if (schemesData.length === 0) {
                container.innerHTML = `
                    <div class="error-message">
                        <h3>No scheme data available</h3>
                        <p>Unable to load scheme information. Please try refreshing the page or contact support.</p>
                        <button class="btn" onclick="fetchSchemeData()">Retry</button>
                    </div>
                `;
                return;
            }

            const schemesHtml = schemesData.map(scheme => `
                <div class="scheme-card ${isFallback ? 'fallback' : ''}" data-scheme-id="${scheme.id}">
                    <div class="scheme-header">
                        <div class="scheme-icon">${scheme.icon}</div>
                        <div class="scheme-title">${scheme.name}</div>
                        <div class="scheme-subtitle">${scheme.fullName}</div>
                    </div>
                    <div class="scheme-content">
                        <div class="scheme-description">
                            ${scheme.description}
                        </div>
                        
                        <div class="eligibility-section">
                            <div class="eligibility-title">
                                <span>‚úì</span> Eligibility Criteria
                            </div>
                            <ul class="eligibility-list">
                                ${scheme.eligibility.map(criteria => `<li>${criteria}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div class="benefits-section">
                            <div class="benefits-title">
                                <span>üí∞</span> Benefits
                            </div>
                            <ul style="list-style: none; padding: 0;">
                                ${scheme.benefits.map(benefit => `<li>‚Ä¢ ${benefit}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div class="application-process">
                            <div class="benefits-title">
                                <span>üìù</span> Application Process
                            </div>
                            <ol class="process-steps">
                                ${scheme.applicationProcess.map(step => `<li>${step}</li>`).join('')}
                            </ol>
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `<div class="schemes-grid">${schemesHtml}</div>`;
        }

        // Update overview statistics
        function updateOverview(isFallback = false) {
            const totalSchemes = schemesData.length;
            const maxBenefit = Math.max(...schemesData.filter(s => typeof s.maxBenefit === 'number').map(s => s.maxBenefit));
            
            const overviewHtml = `
                <p style="color: #666; font-size: 1.1rem; line-height: 1.6;">
                    ${isFallback ? 'Showing cached data. ' : 'Live data from Government API. '}
                    Our system provides access to ${totalSchemes} major government schemes designed to support tribal communities.
                </p>
                
                <div class="overview-stats">
                    <div class="stat-item">
                        <div class="stat-number">${totalSchemes}</div>
                        <div class="stat-label">Active Schemes</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">100%</div>
                        <div class="stat-label">Tribal Coverage</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">‚Çπ${maxBenefit.toLocaleString()}</div>
                        <div class="stat-label">Max Annual Benefit</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${isFallback ? 'Offline' : 'Live'}</div>
                        <div class="stat-label">Data Status</div>
                    </div>
                </div>
            `;
            
            document.getElementById('overviewContent').innerHTML = overviewHtml;
        }

        // Check eligibility with API data
        function checkEligibility() {
            const landArea = parseFloat(document.getElementById('checkLandArea').value) || 0;
            const landType = document.getElementById('checkLandType').value;
            const income = parseFloat(document.getElementById('checkIncome').value) || 0;

            if (!landType) {
                showAlert('Please select a land type', 'error');
                return;
            }

            if (schemesData.length === 0) {
                showAlert('Scheme data not available. Please refresh the page.', 'error');
                return;
            }

            const eligibleSchemes = [];

            schemesData.forEach(scheme => {
                let isEligible = true;
                let reason = [];

                // Check land type requirement
                if (scheme.landTypeRequired && !scheme.landTypeRequired.includes(landType)) {
                    isEligible = false;
                } else if (scheme.landTypeRequired) {
                    reason.push(`Land type: ${landType}`);
                }

                // Check land area requirement
                if (scheme.maxLandArea !== null && landArea > scheme.maxLandArea) {
                    isEligible = false;
                } else if (scheme.maxLandArea !== null) {
                    reason.push(`Land area: ${landArea} acres (‚â§ ${scheme.maxLandArea})`);
                }

                // Check income requirement
                if (scheme.maxIncome !== null && income >= scheme.maxIncome) {
                    isEligible = false;
                } else if (scheme.maxIncome !== null) {
                    reason.push(`Income: ‚Çπ${income.toLocaleString()} (< ‚Çπ${scheme.maxIncome.toLocaleString()})`);
                }

                if (isEligible) {
                    eligibleSchemes.push({
                        ...scheme,
                        reason: reason.join(', ')
                    });
                }
            });

            displayEligibilityResults(eligibleSchemes);
        }

        // Display eligibility results
        function displayEligibilityResults(schemes) {
            const results = document.getElementById('eligibilityResults');
            
            if (schemes.length > 0) {
                results.className = 'results-display eligible';
                results.innerHTML = `
                    <h3 style="color: #28a745; margin-bottom: 15px;">üéâ You are eligible for ${schemes.length} scheme(s)!</h3>
                    <ul class="scheme-list">
                        ${schemes.map(scheme => `
                            <li>
                                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                    <span style="font-size: 1.5em; margin-right: 10px;">${scheme.icon}</span>
                                    <strong>${scheme.name}</strong>
                                </div>
                                <small style="color: #666;">
                                    Max Benefit: ${typeof scheme.maxBenefit === 'number' ? '‚Çπ' + scheme.maxBenefit.toLocaleString() : scheme.maxBenefit}
                                </small><br>
                                <small style="color: #28a745;">Eligible because: ${scheme.reason}</small>
                            </li>
                        `).join('')}
                    </ul>
                    <div style="margin-top: 15px;">
                        <button class="btn" onclick="downloadEligibilityReport('${JSON.stringify(schemes).replace(/"/g, '&quot;')}')">
                            üìÑ Download Eligibility Report
                        </button>
                        <button class="btn" onclick="findNearestOffice()">
                            üìç Find Nearest Office
                        </button>
                    </div>
                `;
                showAlert(`You're eligible for ${schemes.length} schemes!`, 'success');
            } else {
                results.className = 'results-display not-eligible';
                results.innerHTML = `
                    <h3 style="color: #dc3545; margin-bottom: 15px;">‚ùå No schemes match your current criteria</h3>
                    <p>Based on your inputs, you don't currently meet the eligibility criteria for available schemes.</p>
                    <div style="background: rgba(255,255,255,0.8); padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h4 style="color: #333;">Suggestions to improve eligibility:</h4>
                        <ul style="margin: 10px 0; color: #666;">
                            <li>Update your land records with local authorities</li>
                            <li>Consider income-generating activities to qualify for employment schemes</li>
                            <li>Check with Gram Panchayat for additional local schemes</li>
                            <li>Contact the helpline for personalized guidance</li>
                        </ul>
                    </div>
                    <button class="btn" onclick="resetEligibilityChecker()">
                        üîÑ Try Different Values
                    </button>
                `;
                showAlert('No matching schemes found. Try adjusting your criteria.', 'warning');
            }
            
            results.style.display = 'block';
        }

        // Download eligibility report
        function downloadEligibilityReport(schemesJson) {
            try {
                const schemes = JSON.parse(schemesJson.replace(/&quot;/g, '"'));
                const reportContent = generateEligibilityReport(schemes);
                
                const blob = new Blob([reportContent], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'scheme-eligibility-report.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                showAlert('Eligibility report downloaded successfully!', 'success');
            } catch (error) {
                console.error('Error generating report:', error);
                showAlert('Error generating report. Please try again.', 'error');
            }
        }

        // Generate eligibility report content
        function generateEligibilityReport(schemes) {
            const date = new Date().toLocaleDateString('en-IN');
            let report = `GOVERNMENT SCHEME ELIGIBILITY REPORT\n`;
            report += `Generated on: ${date}\n`;
            report += `Generated by: Tribal Land Management System\n\n`;
            report += `==============================================\n\n`;
            
            schemes.forEach((scheme, index) => {
                report += `${index + 1}. ${scheme.name}\n`;
                report += `   Full Name: ${scheme.fullName}\n`;
                report += `   Eligibility Reason: ${scheme.reason}\n`;
                report += `   Maximum Benefit: ${typeof scheme.maxBenefit === 'number' ? '‚Çπ' + scheme.maxBenefit.toLocaleString() : scheme.maxBenefit}\n`;
                report += `   \n   Benefits:\n`;
                scheme.benefits.forEach(benefit => {
                    report += `   - ${benefit}\n`;
                });
                report += `   \n   Application Process:\n`;
                scheme.applicationProcess.forEach((step, i) => {
                    report += `   ${i + 1}. ${step}\n`;
                });
                report += `\n   ------------------------------\n\n`;
            });
            
            report += `IMPORTANT NOTES:\n`;
            report += `- This is an automated eligibility check based on basic criteria\n`;
            report += `- Final eligibility will be determined by the respective department\n`;
            report += `- Please carry all required documents when applying\n`;
            report += `- Contact the helpline (1800-180-1551) for assistance\n\n`;
            report += `For more information, visit the official government portals mentioned in the contact section.`;
            
            return report;
        }

        // Find nearest office (placeholder function)
        function findNearestOffice() {
            showAlert('Redirecting to office locator...', 'info');
            // In a real implementation, this would integrate with maps API
            setTimeout(() => {
                showAlert('Feature coming soon! Please contact the helpline for office locations.', 'info');
            }, 1000);
        }

        // Refresh scheme data
        async function refreshSchemeData() {
            const refreshBtn = document.getElementById('refreshBtn');
            const originalText = refreshBtn.textContent;
            
            refreshBtn.disabled = true;
            refreshBtn.innerHTML = '<span class="loading-spinner"></span> Refreshing...';
            
            try {
                await fetchSchemeData();
                showAlert('Scheme data refreshed successfully!', 'success');
            } catch (error) {
                showAlert('Failed to refresh data. Using cached version.', 'error');
            } finally {
                refreshBtn.disabled = false;
                refreshBtn.textContent = originalText;
            }
        }

        // Update API status
        function updateApiStatus(status, message) {
            const statusElement = document.getElementById('apiStatus');
            statusElement.className = `api-status ${status}`;
            
            let icon = '';
            switch (status) {
                case 'connected':
                    icon = '‚úÖ';
                    break;
                case 'disconnected':
                    icon = '‚ùå';
                    break;
                case 'loading':
                    icon = '<span class="loading-spinner"></span>';
                    break;
            }
            
            statusElement.innerHTML = `${icon} ${message}`;
        }

        // Check data freshness
        function checkDataFreshness() {
            const now = Date.now();
            if (now - lastFetchTime > CONFIG.CACHE_DURATION) {
                fetchSchemeData();
            }
        }

        // Start auto refresh
        function startAutoRefresh() {
            clearInterval(autoRefreshInterval);
            autoRefreshInterval = setInterval(() => {
                if (!document.hidden && navigator.onLine) {
                    checkDataFreshness();
                }
            }, CONFIG.REFRESH_INTERVAL);
        }

        // Setup form validation
        function setupFormValidation() {
            const inputs = document.querySelectorAll('#checkLandArea, #checkIncome');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    if (this.value < 0) {
                        this.value = 0;
                        showAlert('Value cannot be negative', 'error');
                    }
                });
            });
        }

        // Initialize animations
        function initializeAnimations() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('fade-in');
                    }
                });
            });

            document.querySelectorAll('.overview-card, .quick-eligibility').forEach(el => {
                observer.observe(el);
            });
        }

        // Reset eligibility checker
        function resetEligibilityChecker() {
            document.getElementById('checkLandArea').value = '';
            document.getElementById('checkLandType').value = '';
            document.getElementById('checkIncome').value = '';
            document.getElementById('eligibilityResults').style.display = 'none';
        }

        // Scroll to eligibility checker
        function scrollToChecker() {
            document.getElementById('eligibilityChecker').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }

        // Navigate to dashboard
        function goToDashboard() {
            try {
                clearInterval(autoRefreshInterval);
                showAlert('Navigating to dashboard...', 'info');
                
                setTimeout(() => {
                    if (window.location.protocol === 'file:') {
                        window.location.href = 'index.html';
                    } else {
                        window.location.href = '/dashboard';
                    }
                }, 100);
                
            } catch (error) {
                console.error('Navigation error:', error);
                showAlert('Navigation error. Please try again.', 'error');
            }
        }

        // Show alert messages
        function showAlert(message, type = 'info') {
            const existingAlerts = document.querySelectorAll('.alert');
            existingAlerts.forEach(alert => alert.remove());
            
            const alertColors = {
                success: 'linear-gradient(45deg, #28a745, #20c997)',
                error: 'linear-gradient(45deg, #dc3545, #c82333)',
                warning: 'linear-gradient(45deg, #ffc107, #fd7e14)',
                info: 'linear-gradient(45deg, #17a2b8, #138496)'
            };
            
            const alert = document.createElement('div');
            alert.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 1001;
                max-width: 300px;
                animation: slideInRight 0.3s ease-out;
                background: ${alertColors[type]};
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            `;
            alert.textContent = message;
            
            document.body.appendChild(alert);
            
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.style.animation = 'slideOutRight 0.3s ease-in';
                    setTimeout(() => alert.remove(), 300);
                }
            }, 4000);
        }

        // Handle page cleanup
        window.addEventListener('beforeunload', () => {
            clearInterval(autoRefreshInterval);
        });

        // Add keyframe animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>