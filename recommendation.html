<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search & Recommendations - Tribal Land System</title>
    
    <!-- Prevent caching to ensure fresh loads -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .breadcrumb {
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 25px;
            color: white;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .breadcrumb a {
            color: white;
            text-decoration: none;
            opacity: 0.8;
        }

        .breadcrumb a:hover {
            opacity: 1;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        /* Last updated indicator */
        .last-updated {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(40, 167, 69, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .last-updated.show {
            opacity: 1;
        }

        /* Search Tabs */
        .search-tabs {
            display: flex;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            background: white;
            color: #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .search-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .search-box {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            position: relative;
        }

        .search-input input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 2px solid #ddd;
            border-radius: 50px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8f9ff;
        }

        .search-input input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #667eea;
            font-size: 1.2rem;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-clear {
            background: linear-gradient(45deg, #6c757d, #495057);
            padding: 15px 25px;
        }

        .suggestions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .suggestion-chip {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            border: 1px solid rgba(102, 126, 234, 0.2);
            transition: all 0.3s ease;
        }

        .suggestion-chip:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: translateY(-1px);
        }

        .results-section {
            display: none;
        }

        /* Progress Tracker Styles */
        .progress-tracker {
            background: white;
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 30px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .progress-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .claim-id-display {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .progress-timeline {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 40px 0;
        }

        .progress-line {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background: #e9ecef;
            transform: translateY(-50%);
            z-index: 1;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #28a745, #20c997);
            border-radius: 2px;
            transition: width 1s ease;
            width: 0%;
        }

        .progress-step {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }

        .step-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            border: 4px solid #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: #6c757d;
            transition: all 0.5s ease;
            margin-bottom: 15px;
        }

        .step-circle.completed {
            background: #28a745;
            border-color: #28a745;
            color: white;
            animation: checkmark 0.5s ease;
        }

        .step-circle.current {
            background: #ffc107;
            border-color: #ffc107;
            color: white;
            animation: pulse 2s infinite;
        }

        .step-info {
            text-align: center;
            max-width: 150px;
        }

        .step-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .step-description {
            color: #666;
            font-size: 12px;
            line-height: 1.4;
        }

        .step-date {
            color: #28a745;
            font-size: 11px;
            font-weight: 600;
            margin-top: 5px;
        }

        @keyframes checkmark {
            0% {
                transform: scale(0.8);
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(255, 193, 7, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 193, 7, 0);
            }
        }

        .claim-details {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
            border-left: 5px solid #667eea;
        }

        .detail-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-weight: 600;
            color: #555;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .detail-value {
            color: #333;
            font-size: 16px;
        }

        .land-details-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .land-details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .land-details-header h2 {
            color: #333;
            font-size: 1.8rem;
        }

        .status-badge {
            background: #28a745;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-approved {
            background: #28a745;
            color: white;
        }

        .status-pending {
            background: #ffc107;
            color: #856404;
        }

        .status-rejected {
            background: #dc3545;
            color: white;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .schemes-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .schemes-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .schemes-header h2 {
            color: #333;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .schemes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .scheme-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .scheme-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.6s;
            opacity: 0;
        }

        .scheme-card:hover::before {
            animation: shimmer 1.5s ease-in-out;
        }

        .scheme-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .scheme-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .scheme-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .scheme-description {
            font-size: 0.9rem;
            opacity: 0.9;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .scheme-status {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .not-eligible {
            background: linear-gradient(135deg, #6c757d, #495057);
        }

        .no-results {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .no-results-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-item {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Alert system */
        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            animation: slideInRight 0.3s ease-out;
        }

        .alert-success {
            background: linear-gradient(45deg, #28a745, #20c997);
        }

        .alert-error {
            background: linear-gradient(45deg, #dc3545, #c82333);
        }

        .alert-info {
            background: linear-gradient(45deg, #17a2b8, #138496);
        }

        /* Fade-in animation for content refresh */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); opacity: 0; }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .search-tabs {
                flex-direction: column;
            }
            
            .search-box {
                flex-direction: column;
            }
            
            .details-grid {
                grid-template-columns: 1fr;
            }
            
            .schemes-grid {
                grid-template-columns: 1fr;
            }
            
            .progress-timeline {
                flex-direction: column;
                gap: 30px;
            }
            
            .progress-line {
                width: 4px;
                height: calc(100% - 60px);
                left: 50%;
                top: 30px;
                transform: translateX(-50%);
            }
            
            .detail-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Last updated indicator -->
    <div id="lastUpdated" class="last-updated"></div>

    <div class="container fade-in">
        <div class="breadcrumb">
            <a href="javascript:void(0)" onclick="goToDashboard()">🏠 Dashboard</a> / 🔍 Search & Recommendations
        </div>

        <div class="header">
            <h1>🔍 Search & Recommendations</h1>
            <p>Find land records, track claims, and discover eligible government schemes</p>
        </div>

        <!-- Quick Statistics -->
        <div class="quick-stats">
            <div class="stat-item">
                <div class="stat-number" id="totalRecords">8</div>
                <div class="stat-label">Total Records</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="totalClaims">3</div>
                <div class="stat-label">Active Claims</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="totalSchemes">4</div>
                <div class="stat-label">Available Schemes</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="avgEligible">2.5</div>
                <div class="stat-label">Avg. Eligible Schemes</div>
            </div>
        </div>

        <!-- Search Tabs -->
        <div class="search-tabs">
            <button class="tab-button active" onclick="switchTab('land-search')">📋 Land Records</button>
            <button class="tab-button" onclick="switchTab('claim-search')">📊 Claim Progress</button>
            <button class="tab-button" onclick="switchTab('scheme-search')">🎯 Scheme Finder</button>
        </div>

        <!-- Land Records Search Tab -->
        <div id="land-search" class="tab-content active">
            <div class="search-container">
                <h2 style="color: #333; margin-bottom: 20px;">🔎 Search by Patta ID</h2>
                
                <div class="search-box">
                    <div class="search-input">
                        <input type="text" id="pattaSearch" placeholder="Enter Patta ID (e.g., PT2023001)" 
                               onkeypress="handleKeyPress(event)" autocomplete="off">
                        <div class="search-icon">🔍</div>
                    </div>
                    <button class="btn" onclick="searchByPattaId()">Search</button>
                    <button class="btn btn-clear" onclick="clearSearch()">Clear</button>
                </div>

                <div class="suggestions" id="suggestionsContainer">
                    <div class="suggestion-chip" onclick="searchSuggestion('PT2023001')">PT2023001 - Ram Kumar Oraon</div>
                    <div class="suggestion-chip" onclick="searchSuggestion('PT2023002')">PT2023002 - Sita Devi Munda</div>
                    <div class="suggestion-chip" onclick="searchSuggestion('PT2023003')">PT2023003 - Mohan Tirkey</div>
                    <div class="suggestion-chip" onclick="searchSuggestion('PT2023004')">PT2023004 - Anjali Lakra</div>
                </div>
            </div>
        </div>

        <!-- Claim Progress Tab -->
        <div id="claim-search" class="tab-content">
            <div class="search-container">
                <h2 style="color: #333; margin-bottom: 20px;">📊 Track Claim Progress</h2>
                
                <div class="search-box">
                    <div class="search-input">
                        <input type="text" id="claimSearch" placeholder="Enter Claim ID (e.g., CL2025001)" 
                               onkeypress="handleClaimKeyPress(event)" autocomplete="off">
                        <div class="search-icon">📊</div>
                    </div>
                    <button class="btn" onclick="searchClaimProgress()">Track Progress</button>
                    <button class="btn btn-clear" onclick="clearClaimSearch()">Clear</button>
                </div>

                <div class="suggestions" id="claimSuggestionsContainer">
                    <div class="suggestion-chip" onclick="searchClaimSuggestion('CL2025001')">CL2025001 - Fully Approved</div>
                    <div class="suggestion-chip" onclick="searchClaimSuggestion('CL2025002')">CL2025002 - At SDLC Stage</div>
                    <div class="suggestion-chip" onclick="searchClaimSuggestion('CL2025003')">CL2025003 - At Gram Sabha</div>
                </div>
            </div>
        </div>

        <!-- Scheme Finder Tab -->
        <div id="scheme-search" class="tab-content">
            <div class="search-container">
                <h2 style="color: #333; margin-bottom: 20px;">🎯 Find Eligible Schemes</h2>
                
                <div class="search-box">
                    <div class="search-input">
                        <input type="text" id="schemeSearch" placeholder="Enter Patta ID to check scheme eligibility" 
                               onkeypress="handleSchemeKeyPress(event)" autocomplete="off">
                        <div class="search-icon">🎯</div>
                    </div>
                    <button class="btn" onclick="searchSchemeEligibility()">Check Eligibility</button>
                    <button class="btn btn-clear" onclick="clearSchemeSearch()">Clear</button>
                </div>

                <div class="suggestions" id="schemeSuggestionsContainer">
                    <div class="suggestion-chip" onclick="searchSchemeSuggestion('PT2023001')">PT2023001 - 3 Eligible Schemes</div>
                    <div class="suggestion-chip" onclick="searchSchemeSuggestion('PT2023002')">PT2023002 - 2 Eligible Schemes</div>
                    <div class="suggestion-chip" onclick="searchSchemeSuggestion('PT2023003')">PT2023003 - 3 Eligible Schemes</div>
                </div>
            </div>
        </div>

        <!-- Results Section for Land Records -->
        <div id="resultsSection" class="results-section">
            <!-- Land Details Card -->
            <div class="land-details-card">
                <div class="land-details-header">
                    <h2>📄 Land Record Details</h2>
                    <div class="status-badge">Active Record</div>
                </div>
                <div id="landDetailsContent"></div>
            </div>

            <!-- Schemes Container -->
            <div class="schemes-container">
                <div class="schemes-header">
                    <h2>🎯 Scheme Recommendations</h2>
                    <p style="color: #666;">Based on your land record and eligibility criteria</p>
                </div>
                <div id="schemesContent"></div>
            </div>
        </div>

        <!-- Claim Progress Results -->
        <div id="claimResultsSection" class="results-section">
            <div id="claimProgressContainer"></div>
        </div>

        <!-- No Results -->
        <div id="noResults" style="display: none;">
            <div class="search-container">
                <div class="no-results">
                    <div class="no-results-icon">🔍</div>
                    <h3>No Record Found</h3>
                    <p>No record found with the specified ID.</p>
                    <p style="margin-top: 10px;">
                        <a href="javascript:void(0)" onclick="goToAddRecords()" style="color: #667eea;">Add a new record</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let landRecords = [];
        let isPageReloaded = false;
        let autoRefreshInterval;

        // Sample land records data
        const sampleLandRecords = {
            'PT2023001': {
                pattaId: 'PT2023001',
                ownerName: 'Ram Kumar Oraon',
                landArea: 2.5,
                village: 'Khunti',
                district: 'Ranchi',
                state: 'Jharkhand',
                landType: 'Agricultural',
                surveyNumber: 'SY/101/2023',
                registrationDate: '2023-03-15',
                status: 'Active',
                schemes: ['forest-rights', 'agriculture-loan', 'crop-insurance']
            },
            'PT2023002': {
                pattaId: 'PT2023002',
                ownerName: 'Sita Devi Munda',
                landArea: 1.8,
                village: 'Sisai',
                district: 'Gumla',
                state: 'Jharkhand',
                landType: 'Forest',
                surveyNumber: 'SY/102/2023',
                registrationDate: '2023-04-20',
                status: 'Active',
                schemes: ['forest-rights', 'tribal-development']
            },
            'PT2023003': {
                pattaId: 'PT2023003',
                ownerName: 'Mohan Tirkey',
                landArea: 3.2,
                village: 'Torpa',
                district: 'Khunti',
                state: 'Jharkhand',
                landType: 'Mixed',
                surveyNumber: 'SY/103/2023',
                registrationDate: '2023-05-10',
                status: 'Active',
                schemes: ['forest-rights', 'agriculture-loan', 'soil-health']
            },
            'PT2023004': {
                pattaId: 'PT2023004',
                ownerName: 'Anjali Lakra',
                landArea: 1.5,
                village: 'Rania',
                district: 'Khunti',
                state: 'Jharkhand',
                landType: 'Residential',
                surveyNumber: 'SY/104/2023',
                registrationDate: '2023-06-05',
                status: 'Active',
                schemes: ['housing-scheme', 'tribal-development']
            }
        };

        // Sample claim data with different progress stages
        const claimData = {
            'CL2025001': {
                claimId: 'CL2025001',
                pattaId: 'PT2023001',
                ownerName: 'Ram Kumar Oraon',
                landArea: 2.5,
                village: 'Khunti',
                district: 'Ranchi',
                claimType: 'Individual Forest Rights',
                submittedDate: '2025-01-10',
                currentStage: 3,
                status: 'Approved',
                stages: [
                    {
                        name: 'Gram Sabha',
                        description: 'Village level verification and approval',
                        status: 'completed',
                        approvedDate: '2025-01-25',
                        approver: 'Khunti Gram Sabha'
                    },
                    {
                        name: 'SDLC',
                        description: 'Sub Divisional Level Committee review',
                        status: 'completed',
                        approvedDate: '2025-02-10',
                        approver: 'Ranchi SDLC'
                    },
                    {
                        name: 'DLC',
                        description: 'District Level Committee final approval',
                        status: 'completed',
                        approvedDate: '2025-02-28',
                        approver: 'Ranchi DLC'
                    }
                ]
            },
            'CL2025002': {
                claimId: 'CL2025002',
                pattaId: 'PT2023002',
                ownerName: 'Sita Devi Munda',
                landArea: 1.8,
                village: 'Sisai',
                district: 'Gumla',
                claimType: 'Community Forest Resource',
                submittedDate: '2025-02-01',
                currentStage: 2,
                status: 'Under Review',
                stages: [
                    {
                        name: 'Gram Sabha',
                        description: 'Village level verification and approval',
                        status: 'completed',
                        approvedDate: '2025-02-15',
                        approver: 'Sisai Gram Sabha'
                    },
                    {
                        name: 'SDLC',
                        description: 'Sub Divisional Level Committee review',
                        status: 'current',
                        approvedDate: null,
                        approver: null
                    },
                    {
                        name: 'DLC',
                        description: 'District Level Committee final approval',
                        status: 'pending',
                        approvedDate: null,
                        approver: null
                    }
                ]
            },
            'CL2025003': {
                claimId: 'CL2025003',
                pattaId: 'PT2023003',
                ownerName: 'Mohan Tirkey',
                landArea: 3.2,
                village: 'Torpa',
                district: 'Khunti',
                claimType: 'Individual Forest Rights',
                submittedDate: '2025-02-15',
                currentStage: 1,
                status: 'Under Review',
                stages: [
                    {
                        name: 'Gram Sabha',
                        description: 'Village level verification and approval',
                        status: 'current',
                        approvedDate: null,
                        approver: null
                    },
                    {
                        name: 'SDLC',
                        description: 'Sub Divisional Level Committee review',
                        status: 'pending',
                        approvedDate: null,
                        approver: null
                    },
                    {
                        name: 'DLC',
                        description: 'District Level Committee final approval',
                        status: 'pending',
                        approvedDate: null,
                        approver: null
                    }
                ]
            }
        };

        // Government schemes data
        const governmentSchemes = {
            'forest-rights': {
                id: 'forest-rights',
                title: 'Forest Rights Act',
                icon: '🌳',
                description: 'Individual and community forest rights under FRA 2006',
                eligibility: ['forest-dwelling', 'tribal-community'],
                status: 'Available',
                benefits: 'Land title and forest usage rights'
            },
            'agriculture-loan': {
                id: 'agriculture-loan',
                title: 'Kisan Credit Card',
                icon: '🚜',
                description: 'Agricultural credit facility for farmers',
                eligibility: ['agricultural-land', 'valid-documents'],
                status: 'Available',
                benefits: 'Low-interest agricultural loans'
            },
            'crop-insurance': {
                id: 'crop-insurance',
                title: 'Pradhan Mantri Fasal Bima',
                icon: '🌾',
                description: 'Crop insurance scheme for agricultural risks',
                eligibility: ['agricultural-land', 'crop-cultivation'],
                status: 'Available',
                benefits: 'Insurance coverage for crop losses'
            },
            'tribal-development': {
                id: 'tribal-development',
                title: 'Tribal Development Scheme',
                icon: '🏘️',
                description: 'Development programs for tribal communities',
                eligibility: ['tribal-certificate', 'rural-area'],
                status: 'Available',
                benefits: 'Infrastructure and livelihood support'
            },
            'housing-scheme': {
                id: 'housing-scheme',
                title: 'PM Awas Yojana',
                icon: '🏠',
                description: 'Housing scheme for economically weaker sections',
                eligibility: ['below-poverty-line', 'no-existing-house'],
                status: 'Available',
                benefits: 'Financial assistance for house construction'
            },
            'soil-health': {
                id: 'soil-health',
                title: 'Soil Health Card',
                icon: '🌱',
                description: 'Soil testing and health monitoring program',
                eligibility: ['agricultural-land', 'farming-activity'],
                status: 'Available',
                benefits: 'Free soil testing and recommendations'
            }
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            handlePageLoad();
            initializePage();
            setupPageVisibilityHandler();
            startAutoRefresh();
        });

        // Handle page load and reload detection
        function handlePageLoad() {
            // Check if page was loaded from cache
            if (performance.navigation.type === 2) {
                forcePageRefresh();
            }
            
            sessionStorage.setItem('searchPageLoadTime', Date.now().toString());
            
            // Check for stale content
            const lastVisit = localStorage.getItem('lastSearchVisit');
            const currentTime = Date.now();
            
            if (lastVisit && (currentTime - parseInt(lastVisit)) > 5000) {
                refreshPageContent();
            }
            
            localStorage.setItem('lastSearchVisit', currentTime.toString());
        }

        // Force page refresh if needed
        function forcePageRefresh() {
            if (!isPageReloaded) {
                isPageReloaded = true;
                window.location.reload(true);
            }
        }

        // Setup page visibility handler
        function setupPageVisibilityHandler() {
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    refreshPageContent();
                }
            });
        }

        // Initialize page content
        function initializePage() {
            landRecords = Object.values(sampleLandRecords);
            updateStats();
            showLastUpdated();
        }

        // Start auto-refresh functionality
        function startAutoRefresh() {
            autoRefreshInterval = setInterval(() => {
                updateStats();
                showLastUpdated();
            }, 30000); // Refresh every 30 seconds
        }

        // Refresh page content
        function refreshPageContent() {
            updateStats();
            showLastUpdated();
            
            // Add fade-in effect
            document.querySelector('.container').classList.add('fade-in');
            setTimeout(() => {
                document.querySelector('.container').classList.remove('fade-in');
            }, 500);
        }

        // Show last updated indicator
        function showLastUpdated() {
            const indicator = document.getElementById('lastUpdated');
            const now = new Date();
            indicator.textContent = `Updated: ${now.toLocaleTimeString()}`;
            indicator.classList.add('show');
            
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 3000);
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalRecords').textContent = Object.keys(sampleLandRecords).length;
            document.getElementById('totalClaims').textContent = Object.keys(claimData).length;
            document.getElementById('totalSchemes').textContent = Object.keys(governmentSchemes).length;
            
            // Calculate average eligible schemes
            let totalEligible = 0;
            Object.values(sampleLandRecords).forEach(record => {
                totalEligible += record.schemes.length;
            });
            const avgEligible = (totalEligible / Object.keys(sampleLandRecords).length).toFixed(1);
            document.getElementById('avgEligible').textContent = avgEligible;
        }

        // Tab switching functionality
        function switchTab(tabId) {
            // Remove active class from all tabs and content
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
            
            // Hide all results sections
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('claimResultsSection').style.display = 'none';
            document.getElementById('noResults').style.display = 'none';
        }

        // Search functionality for Patta ID
        function searchByPattaId() {
            const pattaId = document.getElementById('pattaSearch').value.trim().toUpperCase();
            
            if (!pattaId) {
                showAlert('Please enter a Patta ID', 'error');
                return;
            }
            
            const record = sampleLandRecords[pattaId];
            
            if (record) {
                displayLandRecord(record);
                showAlert('Record found successfully!', 'success');
            } else {
                document.getElementById('resultsSection').style.display = 'none';
                document.getElementById('noResults').style.display = 'block';
                showAlert('No record found', 'error');
            }
        }

        // Display land record details
        function displayLandRecord(record) {
            const landDetailsHTML = `
                <div class="details-grid">
                    <div class="detail-item">
                        <div class="detail-label">Patta ID</div>
                        <div class="detail-value">${record.pattaId}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Owner Name</div>
                        <div class="detail-value">${record.ownerName}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Land Area</div>
                        <div class="detail-value">${record.landArea} acres</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Village</div>
                        <div class="detail-value">${record.village}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">District</div>
                        <div class="detail-value">${record.district}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Land Type</div>
                        <div class="detail-value">${record.landType}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Survey Number</div>
                        <div class="detail-value">${record.surveyNumber}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Registration Date</div>
                        <div class="detail-value">${new Date(record.registrationDate).toLocaleDateString()}</div>
                    </div>
                </div>
            `;
            
            document.getElementById('landDetailsContent').innerHTML = landDetailsHTML;
            
            // Display eligible schemes
            displayEligibleSchemes(record.schemes);
            
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('noResults').style.display = 'none';
        }

        // Display eligible schemes
        function displayEligibleSchemes(eligibleSchemeIds) {
            let schemesHTML = '<div class="schemes-grid">';
            
            // Display eligible schemes
            eligibleSchemeIds.forEach(schemeId => {
                const scheme = governmentSchemes[schemeId];
                if (scheme) {
                    schemesHTML += createSchemeCard(scheme, true);
                }
            });
            
            // Display some non-eligible schemes
            const allSchemeIds = Object.keys(governmentSchemes);
            const nonEligibleSchemes = allSchemeIds.filter(id => !eligibleSchemeIds.includes(id));
            
            nonEligibleSchemes.slice(0, 2).forEach(schemeId => {
                const scheme = governmentSchemes[schemeId];
                schemesHTML += createSchemeCard(scheme, false);
            });
            
            schemesHTML += '</div>';
            document.getElementById('schemesContent').innerHTML = schemesHTML;
        }

        // Create scheme card HTML
        function createSchemeCard(scheme, isEligible) {
            const cardClass = isEligible ? 'scheme-card' : 'scheme-card not-eligible';
            const statusText = isEligible ? 'Eligible' : 'Not Eligible';
            
            return `
                <div class="${cardClass}">
                    <div class="scheme-icon">${scheme.icon}</div>
                    <div class="scheme-title">${scheme.title}</div>
                    <div class="scheme-description">${scheme.description}</div>
                    <div class="scheme-status">${statusText}</div>
                </div>
            `;
        }

        // Search claim progress
        function searchClaimProgress() {
            const claimId = document.getElementById('claimSearch').value.trim().toUpperCase();
            
            if (!claimId) {
                showAlert('Please enter a Claim ID', 'error');
                return;
            }
            
            const claim = claimData[claimId];
            
            if (claim) {
                displayClaimProgress(claim);
                showAlert('Claim found successfully!', 'success');
            } else {
                document.getElementById('claimResultsSection').style.display = 'none';
                document.getElementById('noResults').style.display = 'block';
                showAlert('No claim found', 'error');
            }
        }

        // Display claim progress
        function displayClaimProgress(claim) {
            const progressHTML = `
                <div class="progress-tracker">
                    <div class="progress-header">
                        <div class="claim-id-display">${claim.claimId}</div>
                        <h3>${claim.claimType}</h3>
                        <p>Status: <strong>${claim.status}</strong></p>
                    </div>
                    
                    <div class="progress-timeline">
                        <div class="progress-line">
                            <div class="progress-fill" style="width: ${(claim.currentStage / claim.stages.length) * 100}%"></div>
                        </div>
                        ${claim.stages.map((stage, index) => createProgressStep(stage, index + 1, claim.currentStage)).join('')}
                    </div>
                    
                    <div class="claim-details">
                        <div class="detail-row">
                            <div class="detail-item">
                                <div class="detail-label">Patta ID</div>
                                <div class="detail-value">${claim.pattaId}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Owner Name</div>
                                <div class="detail-value">${claim.ownerName}</div>
                            </div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-item">
                                <div class="detail-label">Land Area</div>
                                <div class="detail-value">${claim.landArea} acres</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Village</div>
                                <div class="detail-value">${claim.village}</div>
                            </div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-item">
                                <div class="detail-label">District</div>
                                <div class="detail-value">${claim.district}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Submitted Date</div>
                                <div class="detail-value">${new Date(claim.submittedDate).toLocaleDateString()}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('claimProgressContainer').innerHTML = progressHTML;
            document.getElementById('claimResultsSection').style.display = 'block';
            document.getElementById('noResults').style.display = 'none';
        }

        // Create progress step HTML
        function createProgressStep(stage, stepNumber, currentStage) {
            let stepClass = 'step-circle';
            let stepIcon = stepNumber;
            
            if (stage.status === 'completed') {
                stepClass += ' completed';
                stepIcon = '✓';
            } else if (stage.status === 'current') {
                stepClass += ' current';
            }
            
            return `
                <div class="progress-step">
                    <div class="${stepClass}">${stepIcon}</div>
                    <div class="step-info">
                        <div class="step-title">${stage.name}</div>
                        <div class="step-description">${stage.description}</div>
                        ${stage.approvedDate ? `<div class="step-date">Approved: ${new Date(stage.approvedDate).toLocaleDateString()}</div>` : ''}
                        ${stage.approver ? `<div class="step-date">By: ${stage.approver}</div>` : ''}
                    </div>
                </div>
            `;
        }

        // Search scheme eligibility
        function searchSchemeEligibility() {
            const pattaId = document.getElementById('schemeSearch').value.trim().toUpperCase();
            
            if (!pattaId) {
                showAlert('Please enter a Patta ID', 'error');
                return;
            }
            
            const record = sampleLandRecords[pattaId];
            
            if (record) {
                displayAllSchemes(record.schemes);
                showAlert('Eligibility checked successfully!', 'success');
            } else {
                document.getElementById('claimResultsSection').style.display = 'none';
                document.getElementById('noResults').style.display = 'block';
                showAlert('No record found', 'error');
            }
        }

        // Display all schemes with eligibility
        function displayAllSchemes(eligibleSchemeIds) {
            let schemesHTML = '<div class="schemes-container"><div class="schemes-header"><h2>🎯 Scheme Eligibility Results</h2><p style="color: #666;">All available schemes and your eligibility status</p></div><div class="schemes-grid">';
            
            Object.values(governmentSchemes).forEach(scheme => {
                const isEligible = eligibleSchemeIds.includes(scheme.id);
                schemesHTML += createSchemeCard(scheme, isEligible);
            });
            
            schemesHTML += '</div></div>';
            
            document.getElementById('claimProgressContainer').innerHTML = schemesHTML;
            document.getElementById('claimResultsSection').style.display = 'block';
            document.getElementById('noResults').style.display = 'none';
        }

        // Event handlers
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                searchByPattaId();
            }
        }

        function handleClaimKeyPress(event) {
            if (event.key === 'Enter') {
                searchClaimProgress();
            }
        }

        function handleSchemeKeyPress(event) {
            if (event.key === 'Enter') {
                searchSchemeEligibility();
            }
        }

        // Suggestion handlers
        function searchSuggestion(pattaId) {
            document.getElementById('pattaSearch').value = pattaId;
            searchByPattaId();
        }

        function searchClaimSuggestion(claimId) {
            document.getElementById('claimSearch').value = claimId;
            searchClaimProgress();
        }

        function searchSchemeSuggestion(pattaId) {
            document.getElementById('schemeSearch').value = pattaId;
            searchSchemeEligibility();
        }

        // Clear functions
        function clearSearch() {
            document.getElementById('pattaSearch').value = '';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('noResults').style.display = 'none';
        }

        function clearClaimSearch() {
            document.getElementById('claimSearch').value = '';
            document.getElementById('claimResultsSection').style.display = 'none';
            document.getElementById('noResults').style.display = 'none';
        }

        function clearSchemeSearch() {
            document.getElementById('schemeSearch').value = '';
            document.getElementById('claimResultsSection').style.display = 'none';
            document.getElementById('noResults').style.display = 'none';
        }

        // Navigation functions
        function goToDashboard() {
            showAlert('Navigating to Dashboard...', 'info');
            // In a real application, this would navigate to the dashboard
        }

        function goToAddRecords() {
            showAlert('Navigating to Add Records...', 'info');
            // In a real application, this would navigate to add records page
        }

        // Alert system
        function showAlert(message, type) {
            // Remove existing alerts
            const existingAlerts = document.querySelectorAll('.alert');
            existingAlerts.forEach(alert => alert.remove());
            
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        });
    </script>
</body>
</html>